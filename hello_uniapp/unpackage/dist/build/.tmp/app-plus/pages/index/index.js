(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"318d":function(e,t,n){"use strict";var a=n("cd31"),o=n.n(a);o.a},"42f9":function(e,t,n){"use strict";(function(e){n("bc76"),n("921b");a(n("66fd"));var t=a(n("7f7e"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},"7f7e":function(e,t,n){"use strict";n.r(t);var a=n("f3dd"),o=n("ed6f");for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n("318d");var r=n("2877"),l=Object(r["a"])(o["default"],a["a"],a["b"],!1,null,null,null);t["default"]=l.exports},a59d:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("c855"));function o(e){return e&&e.__esModule?e:{default:e}}var i,r=a.default.cityArr,l=!1,s="广州市",u={data:function(){return{listIsFree:!1,showLoadTip:!1,longitude:113.316444,latitude:23.126825,searchWord:"",city_name:"广州市",shadowLayer:!1,adList:[],typeList:[],shopList:[],currentPage:1,totalPage:1,isLast:!0,toolArray:[{name:"分类",id:"0",list:[]},{name:"附近",id:"1",list:[{name:"不限",val:"-1"},{name:"500m",val:"1"},{name:"1000m",val:"2"},{name:"2000m",val:"3"},{name:"5000m",val:"4"}]},{name:"区域",id:"2",list:[]},{name:"排序",id:"3",list:[{name:"默认",val:"-1"},{name:"分润高优先",val:"1"},{name:"距离近优先",val:"2"},{name:"好评高优先",val:"3"},{name:"人均低优先",val:"4"},{name:"人均高优先",val:"5"}]},{name:"筛选",id:"4",list:[{name:"红包",val:"1"},{name:"满减",val:"2"},{name:"闲置",val:"3"},{name:"价格区间20-50",val:"4"},{name:"价格区间50-100",val:"5"},{name:"价格区间100以上",val:"6"}]}],atIndex:null,isShowShadow:!1,currentIndex1:-1,currentIndex2:-1,currentIndex3:-1,currentIndex4:-1,currentIndex5:-1,type1:null,type2:null,type3:null,type4:null,type5:null}},onPullDownRefresh:function(){i=this,setTimeout(function(){e.stopPullDownRefresh(),i.searchWord="",i.atIndex=null,i.isShowShadow=!1,i.shadowLayer=!1,i.searchShop(),i.beginOnload()},1e3)},onShow:function(){i=this,e.getStorage({key:"city",success:function(e){e.data.cityName!=s&&(s=e.data.cityName,i.city_name=s,setTimeout(function(){i.updateCityArea()},500))},fail:function(){}})},onReachBottom:function(){this.nextPage()},onShareAppMessage:function(){return{title:"来和我一起Get新技能吧！",path:"/pages/index/index",imageUrl:"http://www.jfcma.com/public/images/jfcm/logo.png"}},onLoad:function(t){i=this,e.getNetworkType({success:function(t){"none"==t.networkType&&e.showModal({title:"提示",showCancel:!1,confirmText:"知道了",content:"请连接网络后再试！",success:function(e){}})}}),e.removeStorage({key:"city",success:function(e){}}),e.getLocation({type:"wgs84",geocode:!0,success:function(e){i.latitude=e.latitude,i.longitude=e.longitude,i.getCurrentSite(e.longitude,e.latitude)},fail:function(){i.tipMsg("地址信息获取失败请手动选择"),i.updateCityArea()},complete:function(){i.shopList=[],i.loadShopList(1)}}),this.beginOnload()},onPageScroll:function(e){},methods:{getCurrentSite:function(t,n){e.request({url:"https://restapi.amap.com/v3/geocode/regeo?output=json&location="+t+","+n+"&key=f37d49f85f46c59af0ee84115b6c1f3c&radius=0&extensions=all",method:"POST",success:function(e){"OK"==e.data.info&&(s=e.data.regeocode.addressComponent.city,s instanceof Array&&(s=e.data.regeocode.addressComponent.province),i.city_name=s,i.updateCityArea())},fail:function(e){i.tipMsg("地址信息获取失败请手动选择"),i.updateCityArea()},complete:function(e){}})},goDetail:function(t){e.navigateTo({url:"/pages/shop/shop_detail?id="+t})},goTypePage:function(t){var n=t.currentTarget.dataset,a={id:n.id,index:n.index,name:n.name,city:i.city_name,longitude:i.longitude,latitude:i.latitude};e.navigateTo({url:"/pages/shop/shop_list?item="+JSON.stringify(a)})},initProp:function(e){l=!1,i.currentPage=1,i.isLast=!0,i.shopList=[],e&&(i.currentIndex1=-1,i.currentIndex2=-1,i.currentIndex3=-1,i.currentIndex4=-1,i.currentIndex5=-1,i.type1=null,i.type2=null,i.type3=null,i.type4=null,i.type5=null,i.toolArray[0].name="分类",i.toolArray[1].name="附近",i.toolArray[2].name="区域",i.toolArray[3].name="排序",i.toolArray[4].name="筛选")},searchShop:function(){i.initProp(!0),i.loadShopList(1,i.searchWord)},loadShopList:function(t,n,a,o,r,s,u){var c=t,d={limit:10,page:c,lat:i.latitude,lng:i.longitude};void 0!=n&&""!=n.trim()&&(d.keyword=n),void 0!=a&&null!=a&&-1!=a&&(d.cat_id=a),void 0!=o&&null!=o&&-1!=o&&(d.distance=o),void 0!=r&&null!=r&&"-1"!=r&&(d.districts=r),void 0!=s&&null!=s&&-1!=s&&(d.sort=s),void 0!=u&&null!=u&&-1!=u&&(d.type=u),e.request({url:i.$httpUrl+"index.php/api/index/getstoremess",method:"POST",data:d,success:function(e){var t=e.data.result;"1"==e.data.status&&0!=e.data.result.data.length&&(i.isLast=c>=t.last_page,i.currentPage=c,i.shopList=i.shopList.concat(e.data.result.data)),i.shopList.length<=0?i.listIsFree=!0:i.listIsFree=!1},fail:function(e){},complete:function(e){l=!1,i.showLoadTip=!1}})},nextPage:function(){if(i.isLast)e.showToast({title:"没有更多了",icon:"none"});else if(!l){l=!0,i.showLoadTip=!0;var t=i.currentPage+1;i.loadShopList(t,i.searchWord,i.type1,i.type2,i.type3,i.type4,i.type5)}},goChangeCity:function(){e.navigateTo({url:"/pages/city_list/city_list?city="+i.city_name}),i.atIndex=null,i.shadowLayer=!1},updateCityArea:function(){if(null!=r){for(var e=s.replace("市",""),t=[],n=0;n<r.length;n++){if(t.length>0)break;for(var a=0;a<r[n].city.length;a++)if(-1!=r[n].city[a].name.indexOf(e)){t=r[n].city[a].area;break}}setTimeout(function(){i.updateArea(t)},200)}},updateArea:function(e){for(var t=[{name:"不限",val:"-1"}],n=0;n<e.length;n++){var a={name:e[n],val:e[n]};t.push(a)}i.currentIndex3=-1,i.type3=null,i.toolArray[2].list=t},changeType:function(e,t,n,a){switch(t){case 0:i.currentIndex1=e,i.type1=1*n,i.toolArray[0].name=a;break;case 1:i.currentIndex2=e,i.type2=1*n,i.toolArray[1].name=a;break;case 2:i.currentIndex3=e,i.type3=n,i.toolArray[2].name=a;break;case 3:i.currentIndex4=e,i.type4=1*n,i.toolArray[3].name=a;break;case 4:i.currentIndex5=e,i.type5=1*n,i.toolArray[4].name=a;break}i.atIndex=null,i.shadowLayer=!1,i.initProp(!1),i.loadShopList(1,i.searchWord,i.type1,i.type2,i.type3,i.type4,i.type5)},changeToolList:function(e){e===i.atIndex?(i.atIndex=null,i.shadowLayer=!1):(i.atIndex=e,i.shadowLayer=!0)},hideLayer:function(){i.atIndex=null,i.shadowLayer=!1},homeShare:function(t){i.isShowShadow=!i.isShowShadow,0==t?e.scanCode({success:function(t){-1!=t.result.indexOf("jfcm_sym")?e.navigateTo({url:"/pages/shop/canuse_ticket?id="+t.result.split("=")[1]}):i.tipMsg("请扫描正确的收银码")}}):1==t?e.navigateTo({url:"/pages/shop/collect_shop"}):2==t&&e.navigateTo({url:"../shop/ticket_list"})},beginOnload:function(){e.request({url:i.$httpUrl+"index.php/Api/index/getad",method:"POST",data:{pid:51317},success:function(e){"1"==e.data.status&&0!=e.data.result.length&&(i.adList=e.data.result)},fail:function(e){},complete:function(e){}}),e.request({url:i.$httpUrl+"index.php/Api/index/getcategory",method:"POST",success:function(e){if("1"==e.data.status&&0!=e.data.result.length){var t=e.data.result;i.typeList=t;for(var n=[],a=0;a<t.length;a++){var o={name:t[a].name,val:t[a].id+""};n.push(o)}i.toolArray[0].list=n}},fail:function(e){},complete:function(e){}})}}};t.default=u}).call(this,n("6e42")["default"])},cd31:function(e,t,n){},ed6f:function(e,t,n){"use strict";n.r(t);var a=n("a59d"),o=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,function(){return a[e]})}(i);t["default"]=o.a},f3dd:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.getImgSrc("home/home13.png")),a=e.getImgSrc("home/home14.png"),o=e.getImgSrc("home/home15.png"),i=e.getImgSrc("home/home10.png"),r=e.getImgSrc("home/home11.png"),l=e.getImgSrc("home/home12.png"),s=e.getImgSrc("home/home5.png"),u=e.getImgSrc("home/home4.png"),c=e.__map(e.shopList,function(t,n){var a=Math.round(t.distance/100);return{$orig:e.__get_orig(t),g0:a}});e.$mp.data=Object.assign({},{$root:{m0:n,m1:a,m2:o,m3:i,m4:r,m5:l,m6:s,m7:u,l0:c}})},o=[];n.d(t,"a",function(){return a}),n.d(t,"b",function(){return o})}},[["42f9","common/runtime","common/vendor"]]]);